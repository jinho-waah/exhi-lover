{"ast":null,"code":"import _regeneratorRuntime from\"/Users/andrew/Desktop/exhi/exhi/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/andrew/Desktop/exhi/exhi/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/andrew/Desktop/exhi/exhi/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/andrew/Desktop/exhi/exhi/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import axios from\"axios\";import{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import styled from\"styled-components\";import DetailViewer from\"./DetailViewer\";import SubHeader from\"../header/SubHeader\";import Footer from\"../common/Footer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TemplateBlock=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding-top: 0.2rem;\\n  box-sizing: border-box;\\n  background: #000000;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  flex-flow: row wrap;\\n\"])));var DetailTemplate=function DetailTemplate(_ref){var color=_ref.color;var _useParams=useParams(),showId=_useParams.showId;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),tags=_useState4[0],setTags=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),tagsId=_useState6[0],setTagsId=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];useEffect(function(){var fetchShow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var showIdUrl,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setError(null);setShow(null);showIdUrl=\"/api/shows/id/\".concat(showId);_context.next=6;return axios.get(\"https://www.exhi-lover.com\".concat(showIdUrl)// `http://localhost:5100${showIdUrl}`\n);case 6:response=_context.sent;setShow(response.data);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);setError(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function fetchShow(){return _ref2.apply(this,arguments);};}();fetchShow();},[showId]);useEffect(function(){var fetchTagsId=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var tagsIdData,tagsIdArray;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setError(null);_context3.next=4;return Promise.all(show.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(show){var showTagIdurl,response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:showTagIdurl=\"/api/exhibition_tags/shows/\".concat(show.id);_context2.next=3;return axios.get(\"https://exhi-lover.com\".concat(showTagIdurl));case 3:response=_context2.sent;return _context2.abrupt(\"return\",response.data);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref4.apply(this,arguments);};}()));case 4:tagsIdData=_context3.sent;if(tagsIdData.length>0){tagsIdArray=tagsIdData.reduce(function(acc,innerArray){innerArray.forEach(function(row){var exhibition_id=row.exhibition_id,tag_id=row.tag_id;var index=acc.findIndex(function(obj){return obj.exhibition_id===exhibition_id;});if(index===-1){acc.push({exhibition_id:exhibition_id,tags:[tag_id]});}else{acc[index].tags.push(tag_id);}});return acc;},[]);setTagsId(tagsIdArray);}_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);setError(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function fetchTagsId(){return _ref3.apply(this,arguments);};}();fetchTagsId();},[show]);useEffect(function(){var fetchTag=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var tagData;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;setError(null);_context6.next=4;return Promise.all(tagsId.map(/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(_ref6){var exhibition_id,tags,tagNames;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:exhibition_id=_ref6.exhibition_id,tags=_ref6.tags;_context5.next=3;return Promise.all(tags.map(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(tagId){var url,response;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:url=\"/api/tags/\".concat(tagId);_context4.next=3;return axios.get(\"http://exhi-lover.com\".concat(url));case 3:response=_context4.sent;return _context4.abrupt(\"return\",response.data[0].tag_name);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x3){return _ref8.apply(this,arguments);};}()));case 3:tagNames=_context5.sent;return _context5.abrupt(\"return\",{exhibition_id:exhibition_id,tagNames:tagNames});case 5:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x2){return _ref7.apply(this,arguments);};}()));case 4:tagData=_context6.sent;setTags(tagData.reduce(function(acc,_ref9){var exhibition_id=_ref9.exhibition_id,tagNames=_ref9.tagNames;acc[exhibition_id]=tagNames;return acc;},{}));_context6.next=11;break;case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](0);setError(_context6.t0);case 11:case\"end\":return _context6.stop();}}},_callee6,null,[[0,8]]);}));return function fetchTag(){return _ref5.apply(this,arguments);};}();if(tagsId!==null){fetchTag();}},[tagsId]);if(error)return/*#__PURE__*/_jsx(\"div\",{children:\"ERR\"});if(!show)return null;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SubHeader,{}),/*#__PURE__*/_jsx(TemplateBlock,{children:/*#__PURE__*/_jsx(DetailViewer,{show:show,color:color,tags:tags})}),/*#__PURE__*/_jsx(Footer,{})]});};export default DetailTemplate;","map":{"version":3,"names":["axios","useEffect","useState","useParams","styled","DetailViewer","SubHeader","Footer","TemplateBlock","div","DetailTemplate","color","showId","show","setShow","tags","setTags","tagsId","setTagsId","error","setError","fetchShow","showIdUrl","get","response","data","fetchTagsId","Promise","all","map","showTagIdurl","id","tagsIdData","length","tagsIdArray","reduce","acc","innerArray","forEach","row","exhibition_id","tag_id","index","findIndex","obj","push","fetchTag","tagId","url","tag_name","tagNames","tagData"],"sources":["/Users/andrew/Desktop/exhi/exhi/client/src/component/detail/DetailTemplate.js"],"sourcesContent":["import axios from \"axios\";\nimport { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport DetailViewer from \"./DetailViewer\";\nimport SubHeader from \"../header/SubHeader\";\nimport Footer from \"../common/Footer\";\n\nconst TemplateBlock = styled.div`\n  padding-top: 0.2rem;\n  box-sizing: border-box;\n  background: #000000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-flow: row wrap;\n`;\n\nconst DetailTemplate = ({ color }) => {\n  const { showId } = useParams();\n  const [show, setShow] = useState(null);\n  const [tags, setTags] = useState(null);\n  const [tagsId, setTagsId] = useState(null);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchShow = async () => {\n      try {\n        setError(null);\n        setShow(null);\n        const showIdUrl = `/api/shows/id/${showId}`;\n        const response = await axios.get(\n          `https://www.exhi-lover.com${showIdUrl}`\n          // `http://localhost:5100${showIdUrl}`\n        );\n        setShow(response.data);\n      } catch (e) {\n        setError(e);\n      }\n    };\n    fetchShow();\n  }, [showId]);\n\n  useEffect(() => {\n    const fetchTagsId = async () => {\n      try {\n        setError(null);\n        const tagsIdData = await Promise.all(\n          show.map(async (show) => {\n            const showTagIdurl = `/api/exhibition_tags/shows/${show.id}`;\n            const response = await axios.get(\n              `https://exhi-lover.com${showTagIdurl}`\n            );\n            // const response = await axios.get(\n            //   `http://localhost:5100${showTagIdurl}`\n            // );\n            return response.data;\n          })\n        );\n        if (tagsIdData.length > 0) {\n          const tagsIdArray = tagsIdData.reduce((acc, innerArray) => {\n            innerArray.forEach((row) => {\n              const { exhibition_id, tag_id } = row;\n              const index = acc.findIndex(\n                (obj) => obj.exhibition_id === exhibition_id\n              );\n              if (index === -1) {\n                acc.push({ exhibition_id, tags: [tag_id] });\n              } else {\n                acc[index].tags.push(tag_id);\n              }\n            });\n            return acc;\n          }, []);\n          setTagsId(tagsIdArray);\n        }\n      } catch (e) {\n        setError(e);\n      }\n    };\n\n    fetchTagsId();\n  }, [show]);\n\n  useEffect(() => {\n    const fetchTag = async () => {\n      try {\n        setError(null);\n        const tagData = await Promise.all(\n          tagsId.map(async ({ exhibition_id, tags }) => {\n            const tagNames = await Promise.all(\n              tags.map(async (tagId) => {\n                const url = `/api/tags/${tagId}`;\n                const response = await axios.get(`http://exhi-lover.com${url}`);\n                // const response = await axios.get(`http://localhost:5100${url}`);\n                return response.data[0].tag_name;\n              })\n            );\n            return { exhibition_id, tagNames };\n          })\n        );\n        setTags(\n          tagData.reduce((acc, { exhibition_id, tagNames }) => {\n            acc[exhibition_id] = tagNames;\n            return acc;\n          }, {})\n        );\n      } catch (e) {\n        setError(e);\n      }\n    };\n\n    if (tagsId !== null) {\n      fetchTag();\n    }\n  }, [tagsId]);\n\n  if (error) return <div>ERR</div>;\n  if (!show) return null;\n  return (\n    <>\n      <SubHeader />\n      <TemplateBlock>\n        <DetailViewer show={show} color={color} tags={tags} />\n      </TemplateBlock>\n      <Footer />\n    </>\n  );\n};\n\nexport default DetailTemplate;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}